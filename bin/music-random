#!/usr/bin/env ruby

system "music-dirs"

dirs = if Time.now.wday != 5
         File.read(ENV["HOME"] + "/music/dirs").split("\n")
       else
         prefix = ENV['HOME'] + "/music/"
         ds = `find #{prefix}blind.guardian -type d`.split("\n")
         ds.map {|ds| ds[prefix.size .. -1]}
       end

dir = dirs[(rand * dirs.length).to_i]
`mpc clear`
`mpc add #{dir}`

if `mpc playlist` == "" && $?.to_i == 0
  system $0
else
  `mpc play`
end
